jtype: Flow
version: '1'
py_modules:
  - ${{ ENV.PY_MODULE }}
deployments:
  - name: segment
    uses: Segmenter
    uses_metas:
      workspace: ${{ ENV.HW_WORKDIR }}
  - name: craftText
    uses: TextCrafter
  - name: encodeText
    uses: TextEncoder
  - name: textIndexer
    uses: DocVectorIndexer
    uses_with:
      index_file_name: "text.json"
    uses_metas:
      workspace: ${{ ENV.HW_WORKDIR }}
  - name: craftImage
    uses: ImageCrafter
    uses_metas:
      workspace: ${{ ENV.HW_WORKDIR }}
    needs: segment
  - name: encodeImage
    uses: ImageEncoder
  - name: imageIndexer
    uses: DocVectorIndexer
    uses_with:
      index_file_name: "image.json"
    uses_metas:
      workspace: ${{ ENV.HW_WORKDIR }}
  - name: keyValueIndexer
    uses: KeyValueIndexer
    uses_metas:
      workspace: ${{ ENV.HW_WORKDIR }}
    needs: segment
  - name: joinAll
    needs: [ textIndexer, imageIndexer, keyValueIndexer ]
