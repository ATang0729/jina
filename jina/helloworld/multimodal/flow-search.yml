jtype: Flow
version: '1'
with:
  cors: True
  protocol: 'http'
py_modules:
  - ${{ ENV.PY_MODULE }}
deployments:
  - name: craftText
    uses:
      jtype: TextCrafter
  - name: encodeText
    uses: TextEncoder
  - name: textIndexer
    uses: DocVectorIndexer
    uses_with:
      index_file_name: "text.json"
    uses_metas:
      workspace: ${{ ENV.HW_WORKDIR }}
  - name: craftImage
    uses: ImageCrafter
    uses_metas:
      workspace: ${{ ENV.HW_WORKDIR }}
    needs: gateway
  - name: encodeImage
    uses: ImageEncoder
  - name: imageIndexer
    uses: DocVectorIndexer
    uses_with:
      index_file_name: "image.json"
    uses_metas:
      workspace: ${{ ENV.HW_WORKDIR }}
  - name: weightedRanker
    uses: WeightedRanker
    uses_metas:
      workspace: ${{ ENV.HW_WORKDIR }}
    needs: [ textIndexer, imageIndexer ]
  - name: keyvalueIndexer
    uses: KeyValueIndexer
    uses_metas:
      workspace: ${{ ENV.HW_WORKDIR }}
    needs: weightedRanker
